{% extends "student/student_base.html" %}

{% block content %}
<section class="content-section" id="trackerSection" aria-labelledby="trackerHeading">
    <h1 class="section-title" id="trackerHeading">Assignment Requests</h1>

    <!-- Status Filters -->
    <div class="meeting-filters" style="margin-bottom: 20px;">
        <button class="meeting-pill active filter-btn" data-filter="all">All</button>
        <button class="meeting-pill filter-btn" data-filter="pending">New Submitted</button>
        <button class="meeting-pill filter-btn" data-filter="assigned">Assigned</button>
        <button class="meeting-pill filter-btn" data-filter="in-process">In-Process</button>
        <button class="meeting-pill filter-btn" data-filter="completed">Complete</button>
        <button class="meeting-pill filter-btn" data-filter="cancelled">Cancelled</button>
    </div>

    <div class="table-wrapper">
        <table id="trackerTable">
            <thead>
                <tr>
                    <th>Assignment ID</th>
                    <th>Title</th>
                    <th>Priority</th>
                    <th>Service Type</th>
                    <th>Status</th>
                    <th>Submitted Date</th>
                    <th>Due/Exam Date</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for assignment in assignments %}
                <tr data-status="{{ assignment.status }}" data-assignment-id="{{ assignment.id }}">
                    <td><code>{{ assignment.assignment_code }}</code></td>
                    <td>{{ assignment.title }}</td>
                    <td>
                        <span class="priority-badge {{ assignment.priority }}">
                            {{ assignment.priority|title }}
                        </span>
                    </td>
                    <td>{{ assignment.get_service_type_display }}</td>
                    <td>
                        <span class="status-badge {{ assignment.status }}">
                            {% if assignment.status == 'pending' %}
                            <i class="fas fa-star"></i> New Submitted
                            {% elif assignment.status == 'assigned' %}
                            <i class="fas fa-user-check"></i> Assigned
                            {% elif assignment.status == 'in-process' %}
                            <i class="fas fa-cog fa-spin"></i> In-Process
                            {% elif assignment.status == 'completed' %}
                            <i class="fas fa-check"></i> Completed
                            {% else %}
                            {{ assignment.get_status_display }}
                            {% endif %}
                        </span>
                    </td>
                    <td>{{ assignment.created_at|date:"M d, Y" }}</td>
                    <td>
                        {% if assignment.due_date %}
                            {{ assignment.due_date|date:"M d, Y" }}
                        {% elif assignment.exam_date %}
                            {{ assignment.exam_date|date:"M d, Y" }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>
                        <button class="action-btn view-btn" onclick="viewAssignment('{{ assignment.id }}')"><i class="fas fa-eye"></i></button>
                        {% if assignment.status == 'pending' %}
                        <button class="action-btn cancel-btn" onclick="cancelAssignment('{{ assignment.id }}')" title="Cancel Request"><i class="fas fa-times"></i></button>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="8" class="text-center">No assignments found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Empty State -->
    <div id="emptyTrackerState" style="display: none; text-align: center; padding: 40px;">
        <i class="fas fa-inbox" style="font-size: 3rem; color: var(--muted); margin-bottom: 16px;"></i>
        <p style="color: var(--muted); font-size: 1.1rem;">No assignments found for this filter.</p>
    </div>

    <!-- Detail View Container (Initially Hidden) -->
    <div id="assignmentDetailContainer" style="display: none;">
        <!-- This will be populated when viewing an assignment -->
    </div>

    <!-- Cancel Confirmation Modal -->
    <div id="cancelAssignmentModal" class="modal-overlay" style="display: none;">
        <div class="modal-content cancel-modal">
            <div class="modal-header">
                <h3>Cancel Assignment</h3>
                <button class="modal-close" onclick="closeCancelModal()" aria-label="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="warning-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <p class="cancel-warning-text">
                    Are you sure you want to cancel this assignment?
                </p>
                <div class="payment-warning">
                    <i class="fas fa-info-circle"></i>
                    <p><strong>Important:</strong> If you cancel this assignment, any payment that has been made is <strong>not refundable</strong>.</p>
                </div>
                <p class="cancel-detail-text">
                    This assignment will be moved to the cancelled section and cannot be restored.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeCancelModal()">Keep Assignment</button>
                <button class="btn-danger" id="confirmCancelBtn" onclick="confirmCancelAssignment()">Yes, Cancel Assignment</button>
            </div>
        </div>
    </div>
</section>
{% endblock %}
