/**
 * Chat Panel Module
 * Handles group and private chat functionality (frontend-only)
 * TODO: Replace MockDataService calls with WebSocket/API calls when backend is integrated
 */

class ChatPanel {
    constructor(containerId, dataService, currentUser) {
        this.container = document.getElementById(containerId);
        this.dataService = dataService;
        this.currentUser = currentUser || { id: 'user1', name: 'You' };
        this.chatMode = 'group'; // 'group' or 'private'
        this.privateRecipientId = null;
        this.isTyping = false;
        this.typingTimeout = null;
        this.scrolledToBottom = true;
        this.newMessagesCount = 0;
        this.pendingFiles = [];
        
        this.init();
    }

    init() {
        if (!this.container) return;
        
        this.render();
        this.loadMessages();
        this.attachEventListeners();
        this.startAutoScroll();
    }

    render() {
        const participants = this.dataService.getParticipants();
        const otherParticipants = participants.filter(p => p.id !== this.currentUser.id);
        
        this.container.innerHTML = `
            <div class="chat-header">
                <div class="chat-mode-toggle">
                    <button type="button" class="chat-mode-btn ${this.chatMode === 'group' ? 'active' : ''}" 
                            data-mode="group" onclick="chatPanel.switchMode('group')">
                        <i class="fas fa-users"></i> Group
                    </button>
                    <button type="button" class="chat-mode-btn ${this.chatMode === 'private' ? 'active' : ''}" 
                            data-mode="private" onclick="chatPanel.switchMode('private')">
                        <i class="fas fa-user"></i> Direct
                    </button>
                </div>
                <select id="privateChatRecipient" class="private-recipient-select ${this.chatMode === 'group' ? 'hidden' : ''}" 
                        onchange="chatPanel.selectRecipient(this.value)">
                    <option value="">Select participant...</option>
                    ${otherParticipants.map(p => 
                        `<option value="${p.id}">${p.name}</option>`
                    ).join('')}
                </select>
            </div>
            <div class="chat-messages-container" id="chatMessagesContainer">
                <div class="chat-messages" id="chatMessages"></div>
                <div class="typing-indicator hidden" id="typingIndicator">
                    <span></span><span></span><span></span>
                </div>
                <div class="new-messages-badge hidden" id="newMessagesBadge" onclick="chatPanel.scrollToBottom()">
                    <i class="fas fa-arrow-down"></i> <span id="newMessagesCount">0</span> new
                </div>
            </div>
            <div class="chat-input-container">
                <div class="chat-actions">
                    <button type="button" class="chat-action-btn" id="chatEmojiBtn" onclick="chatPanel.toggleEmojiPicker()" 
                            aria-label="Open emoji picker">
                        <i class="fas fa-smile"></i>
                    </button>
                    <button type="button" class="chat-action-btn" id="chatFileBtn" onclick="document.getElementById('chatFileInput').click()" 
                            aria-label="Attach file">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <input type="file" id="chatFileInput" multiple hidden accept="image/*,.pdf,.doc,.docx">
                </div>
                <textarea id="chatInput" class="chat-input-field" placeholder="Type a message..." 
                          rows="1" onkeydown="chatPanel.handleKeyDown(event)" 
                          oninput="chatPanel.handleInput(event)"></textarea>
                <button type="button" class="chat-send-btn" onclick="chatPanel.sendMessage()" aria-label="Send message">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
            <div class="emoji-picker hidden" id="emojiPicker"></div>
        `;

        // Initialize emoji picker
        this.initEmojiPicker();
    }

    initEmojiPicker() {
        const emojiPicker = document.getElementById('emojiPicker');
        const emojis = ['ðŸ˜€', 'ðŸ˜ƒ', 'ðŸ˜„', 'ðŸ˜', 'ðŸ˜†', 'ðŸ˜…', 'ðŸ˜‚', 'ðŸ¤£', 'ðŸ˜Š', 'ðŸ˜‡', 
                       'ðŸ™‚', 'ðŸ™ƒ', 'ðŸ˜‰', 'ðŸ˜Œ', 'ðŸ˜', 'ðŸ¥°', 'ðŸ˜˜', 'ðŸ˜—', 'ðŸ˜™', 'ðŸ˜š',
                       'ðŸ˜‹', 'ðŸ˜›', 'ðŸ˜', 'ðŸ˜œ', 'ðŸ¤ª', 'ðŸ¤¨', 'ðŸ§', 'ðŸ¤“', 'ðŸ˜Ž', 'ðŸ¤©',
                       'ðŸ¥³', 'ðŸ˜', 'ðŸ˜’', 'ðŸ˜ž', 'ðŸ˜”', 'ðŸ˜Ÿ', 'ðŸ˜•', 'ðŸ™', 'â˜¹ï¸', 'ðŸ˜£',
                       'ðŸ˜–', 'ðŸ˜«', 'ðŸ˜©', 'ðŸ¥º', 'ðŸ˜¢', 'ðŸ˜­', 'ðŸ˜¤', 'ðŸ˜ ', 'ðŸ˜¡', 'ðŸ¤¬',
                       'ðŸ¤¯', 'ðŸ˜³', 'ðŸ¥µ', 'ðŸ¥¶', 'ðŸ˜±', 'ðŸ˜¨', 'ðŸ˜°', 'ðŸ˜¥', 'ðŸ˜“', 'ðŸ¤—',
                       'ðŸ¤”', 'ðŸ¤­', 'ðŸ¤«', 'ðŸ¤¥', 'ðŸ˜¶', 'ðŸ˜', 'ðŸ˜‘', 'ðŸ˜¬', 'ðŸ™„', 'ðŸ˜¯',
                       'ðŸ˜¦', 'ðŸ˜§', 'ðŸ˜®', 'ðŸ˜²', 'ðŸ¥±', 'ðŸ˜´', 'ðŸ¤¤', 'ðŸ˜ª', 'ðŸ˜µ', 'ðŸ¤',
                       'ðŸ¥´', 'ðŸ¤¢', 'ðŸ¤®', 'ðŸ¤§', 'ðŸ˜·', 'ðŸ¤’', 'ðŸ¤•', 'ðŸ¤‘', 'ðŸ¤ ', 'ðŸ˜ˆ',
                       'ðŸ‘¿', 'ðŸ‘¹', 'ðŸ‘º', 'ðŸ¤¡', 'ðŸ’©', 'ðŸ‘»', 'ðŸ’€', 'â˜ ï¸', 'ðŸ‘½', 'ðŸ‘¾',
                       'ðŸ¤–', 'ðŸŽƒ', 'ðŸ˜º', 'ðŸ˜¸', 'ðŸ˜¹', 'ðŸ˜»', 'ðŸ˜¼', 'ðŸ˜½', 'ðŸ™€', 'ðŸ˜¿',
                       'ðŸ˜¾', 'ðŸ‘‹', 'ðŸ¤š', 'ðŸ–', 'âœ‹', 'ðŸ––', 'ðŸ‘Œ', 'ðŸ¤', 'âœŒï¸', 'ðŸ¤ž',
                       'ðŸ¤Ÿ', 'ðŸ¤˜', 'ðŸ¤™', 'ðŸ‘ˆ', 'ðŸ‘‰', 'ðŸ‘†', 'ðŸ–•', 'ðŸ‘‡', 'â˜ï¸', 'ðŸ‘',
                       'ðŸ‘Ž', 'âœŠ', 'ðŸ‘Š', 'ðŸ¤›', 'ðŸ¤œ', 'ðŸ‘', 'ðŸ™Œ', 'ðŸ‘', 'ðŸ¤²', 'ðŸ¤',
                       'ðŸ™', 'âœï¸', 'ðŸ’ª', 'ðŸ¦¾', 'ðŸ¦¿', 'ðŸ¦µ', 'ðŸ¦¶', 'ðŸ‘‚', 'ðŸ¦»', 'ðŸ‘ƒ',
                       'ðŸ‘¶', 'ðŸ‘§', 'ðŸ§’', 'ðŸ‘¦', 'ðŸ‘©', 'ðŸ§‘', 'ðŸ‘¨', 'ðŸ‘µ', 'ðŸ§“', 'ðŸ‘´',
                       'ðŸ‘²', 'ðŸ‘³', 'ðŸ§•', 'ðŸ‘®', 'ðŸ‘·', 'ðŸ’‚', 'ðŸ•µï¸', 'ðŸ‘©â€âš•ï¸', 'ðŸ‘¨â€âš•ï¸', 'ðŸ‘©â€ðŸŒ¾',
                       'ðŸ‘¨â€ðŸŒ¾', 'ðŸ‘©â€ðŸ³', 'ðŸ‘¨â€ðŸ³', 'ðŸ‘©â€ðŸŽ“', 'ðŸ‘¨â€ðŸŽ“', 'ðŸ‘©â€ðŸŽ¤', 'ðŸ‘¨â€ðŸŽ¤', 'ðŸ‘©â€ðŸ«', 'ðŸ‘¨â€ðŸ«', 'ðŸ‘©â€ðŸ­',
                       'ðŸ‘¨â€ðŸ­', 'ðŸ‘©â€ðŸ’»', 'ðŸ‘¨â€ðŸ’»', 'ðŸ‘©â€ðŸ’¼', 'ðŸ‘¨â€ðŸ’¼', 'ðŸ‘©â€ðŸ”§', 'ðŸ‘¨â€ðŸ”§', 'ðŸ‘©â€ðŸ”¬', 'ðŸ‘¨â€ðŸ”¬', 'ðŸ‘©â€ðŸŽ¨',
                       'ðŸ‘¨â€ðŸŽ¨', 'ðŸ‘©â€ðŸš’', 'ðŸ‘¨â€ðŸš’', 'ðŸ‘©â€âœˆï¸', 'ðŸ‘¨â€âœˆï¸', 'ðŸ‘©â€ðŸš€', 'ðŸ‘¨â€ðŸš€', 'ðŸ‘©â€âš–ï¸', 'ðŸ‘¨â€âš–ï¸', 'ðŸ¤¶',
                       'ðŸŽ…', 'ðŸ‘¸', 'ðŸ¤´', 'ðŸ‘°', 'ðŸ¤µ', 'ðŸ‘¼', 'ðŸ¤°', 'ðŸ™‡', 'ðŸ’', 'ðŸ™…',
                       'ðŸ™†', 'ðŸ™‹', 'ðŸ§', 'ðŸ¤¦', 'ðŸ¤·', 'ðŸ™Ž', 'ðŸ™', 'ðŸ’‡', 'ðŸ’†', 'ðŸ§–',
                       'ðŸ’ƒ', 'ðŸ•º', 'ðŸ•´', 'ðŸ‘¯', 'ðŸ§˜', 'ðŸ›€', 'ðŸ›Œ', 'ðŸ‘­', 'ðŸ‘«', 'ðŸ‘¬',
                       'ðŸ’', 'ðŸ’‘', 'ðŸ‘ª', 'ðŸ‘¨â€ðŸ‘©â€ðŸ‘§', 'ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦', 'ðŸ‘¨â€ðŸ‘©â€ðŸ‘¦â€ðŸ‘¦', 'ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘§', 'ðŸ‘©â€ðŸ‘©â€ðŸ‘¦', 'ðŸ‘©â€ðŸ‘©â€ðŸ‘§', 'ðŸ‘©â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦',
                       'ðŸ‘©â€ðŸ‘©â€ðŸ‘¦â€ðŸ‘¦', 'ðŸ‘©â€ðŸ‘©â€ðŸ‘§â€ðŸ‘§', 'ðŸ‘¨â€ðŸ‘¨â€ðŸ‘¦', 'ðŸ‘¨â€ðŸ‘¨â€ðŸ‘§', 'ðŸ‘¨â€ðŸ‘¨â€ðŸ‘§â€ðŸ‘¦', 'ðŸ‘¨â€ðŸ‘¨â€ðŸ‘¦â€ðŸ‘¦', 'ðŸ‘¨â€ðŸ‘¨â€ðŸ‘§â€ðŸ‘§', 'ðŸ‘©â€ðŸ‘¦', 'ðŸ‘©â€ðŸ‘§', 'ðŸ‘©â€ðŸ‘§â€ðŸ‘¦',
                       'ðŸ‘©â€ðŸ‘¦â€ðŸ‘¦', 'ðŸ‘©â€ðŸ‘§â€ðŸ‘§', 'ðŸ‘¨â€ðŸ‘¦', 'ðŸ‘¨â€ðŸ‘§', 'ðŸ‘¨â€ðŸ‘§â€ðŸ‘¦', 'ðŸ‘¨â€ðŸ‘¦â€ðŸ‘¦', 'ðŸ‘¨â€ðŸ‘§â€ðŸ‘§', 'ðŸ‘š', 'ðŸ‘•', 'ðŸ‘–',
                       'ðŸ‘”', 'ðŸ‘—', 'ðŸ‘™', 'ðŸ‘˜', 'ðŸ¥»', 'ðŸ©±', 'ðŸ©²', 'ðŸ©³', 'ðŸ‘Ÿ', 'ðŸ‘ž',
                       'ðŸ¥¾', 'ðŸ¥¿', 'ðŸ‘ ', 'ðŸ‘¡', 'ðŸ©°', 'ðŸ‘¢', 'ðŸ§¦', 'ðŸ§¤', 'ðŸ§£', 'ðŸŽ©',
                       'ðŸ§¢', 'ðŸ‘’', 'ðŸŽ“', 'â›‘', 'ðŸ‘‘', 'ðŸ’', 'ðŸ‘', 'ðŸ‘›', 'ðŸ‘œ', 'ðŸ’¼',
                       'ðŸŽ’', 'ðŸ§³', 'â˜‚ï¸', 'ðŸŒ‚', 'ðŸ§µ', 'ðŸ§¶', 'ðŸ‘“', 'ðŸ•¶', 'ðŸ¥½', 'ðŸ¥¼',
                       'ðŸ¦º', 'ðŸ‘¨â€ðŸ¦¯', 'ðŸ‘©â€ðŸ¦¯', 'ðŸ‘¨â€ðŸ¦¼', 'ðŸ‘©â€ðŸ¦¼', 'ðŸ‘¨â€ðŸ¦½', 'ðŸ‘©â€ðŸ¦½', 'ðŸ¶', 'ðŸ±', 'ðŸ­',
                       'ðŸ¹', 'ðŸ°', 'ðŸ¦Š', 'ðŸ»', 'ðŸ¼', 'ðŸ¨', 'ðŸ¯', 'ðŸ¦', 'ðŸ®', 'ðŸ·',
                       'ðŸ½', 'ðŸ¸', 'ðŸµ', 'ðŸ™ˆ', 'ðŸ™‰', 'ðŸ™Š', 'ðŸ’', 'ðŸ”', 'ðŸ§', 'ðŸ¦',
                       'ðŸ¤', 'ðŸ£', 'ðŸ¥', 'ðŸ¦†', 'ðŸ¦…', 'ðŸ¦‰', 'ðŸ¦‡', 'ðŸº', 'ðŸ—', 'ðŸ´',
                       'ðŸ¦„', 'ðŸ', 'ðŸ›', 'ðŸ¦‹', 'ðŸŒ', 'ðŸž', 'ðŸœ', 'ðŸ¦Ÿ', 'ðŸ¦—', 'ðŸ•·',
                       'ðŸ¦‚', 'ðŸ¢', 'ðŸ', 'ðŸ¦Ž', 'ðŸ¦–', 'ðŸ¦•', 'ðŸ™', 'ðŸ¦‘', 'ðŸ¦', 'ðŸ¦ž',
                       'ðŸ¦€', 'ðŸ¡', 'ðŸ ', 'ðŸŸ', 'ðŸ¬', 'ðŸ³', 'ðŸ‹', 'ðŸ¦ˆ', 'ðŸŠ', 'ðŸ…',
                       'ðŸ†', 'ðŸ¦“', 'ðŸ¦', 'ðŸ¦§', 'ðŸ˜', 'ðŸ¦›', 'ðŸ¦', 'ðŸª', 'ðŸ«', 'ðŸ¦’',
                       'ðŸ¦˜', 'ðŸ¦¡', 'ðŸƒ', 'ðŸ‚', 'ðŸ„', 'ðŸŽ', 'ðŸ–', 'ðŸ', 'ðŸ‘', 'ðŸ¦™',
                       'ðŸ', 'ðŸ¦Œ', 'ðŸ•', 'ðŸ©', 'ðŸˆ', 'ðŸ“', 'ðŸ¦ƒ', 'ðŸ¦š', 'ðŸ¦œ', 'ðŸ¦¢',
                       'ðŸ¦©', 'ðŸ•Š', 'ðŸ‡', 'ðŸ¦', 'ðŸ¦¨', 'ðŸ¦¦', 'ðŸ¦¥', 'ðŸ', 'ðŸ€', 'ðŸ¿',
                       'ðŸ¦”', 'ðŸ¾', 'ðŸ‰', 'ðŸ²', 'ðŸŒµ', 'ðŸŽ„', 'ðŸŒ²', 'ðŸŒ³', 'ðŸŒ´', 'ðŸŒ±',
                       'ðŸŒ¿', 'â˜˜ï¸', 'ðŸ€', 'ðŸŽ', 'ðŸŽ‹', 'ðŸƒ', 'ðŸ‚', 'ðŸ', 'ðŸ„', 'ðŸŒ¾',
                       'ðŸ’', 'ðŸŒ·', 'ðŸŒ¹', 'ðŸ¥€', 'ðŸŒº', 'ðŸŒ¸', 'ðŸŒ¼', 'ðŸŒ»', 'ðŸŒž', 'ðŸŒ',
                       'ðŸŒ›', 'ðŸŒœ', 'ðŸŒš', 'ðŸŒ•', 'ðŸŒ–', 'ðŸŒ—', 'ðŸŒ˜', 'ðŸŒ‘', 'ðŸŒ’', 'ðŸŒ“',
                       'ðŸŒ”', 'ðŸŒ™', 'ðŸŒŽ', 'ðŸŒ', 'ðŸŒ', 'ðŸ’«', 'â­', 'ðŸŒŸ', 'âœ¨', 'âš¡',
                       'â˜„ï¸', 'ðŸ’¥', 'ðŸ”¥', 'ðŸŒª', 'ðŸŒˆ', 'â˜€ï¸', 'ðŸŒ¤', 'â›…', 'ðŸŒ¥', 'â˜ï¸',
                       'ðŸŒ¦', 'ðŸŒ§', 'â›ˆ', 'ðŸŒ©', 'â„ï¸', 'â˜ƒï¸', 'â›„', 'ðŸŒ¨', 'ðŸ’§', 'ðŸ’¦',
                       'â˜”', 'â˜‚ï¸', 'ðŸŒŠ', 'ðŸŒ«', 'ðŸ', 'ðŸŽ', 'ðŸ', 'ðŸŠ', 'ðŸ‹', 'ðŸŒ',
                       'ðŸ‰', 'ðŸ‡', 'ðŸ“', 'ðŸˆ', 'ðŸ’', 'ðŸ‘', 'ðŸ¥­', 'ðŸ', 'ðŸ¥¥', 'ðŸ¥',
                       'ðŸ…', 'ðŸ†', 'ðŸ¥‘', 'ðŸ¥¦', 'ðŸ¥¬', 'ðŸ¥’', 'ðŸŒ¶', 'ðŸŒ½', 'ðŸ¥•', 'ðŸ¥”',
                       'ðŸ ', 'ðŸ¥', 'ðŸ¥¯', 'ðŸž', 'ðŸ¥–', 'ðŸ¥¨', 'ðŸ§€', 'ðŸ¥š', 'ðŸ³', 'ðŸ¥ž',
                       'ðŸ¥“', 'ðŸ¥©', 'ðŸ—', 'ðŸ–', 'ðŸŒ­', 'ðŸ”', 'ðŸŸ', 'ðŸ•', 'ðŸ¥ª', 'ðŸ¥™',
                       'ðŸŒ®', 'ðŸŒ¯', 'ðŸ¥—', 'ðŸ¥˜', 'ðŸ¥«', 'ðŸ', 'ðŸœ', 'ðŸ²', 'ðŸ›', 'ðŸ£',
                       'ðŸ±', 'ðŸ¥Ÿ', 'ðŸ¤', 'ðŸ™', 'ðŸš', 'ðŸ˜', 'ðŸ¥', 'ðŸ¥ ', 'ðŸ¥®', 'ðŸ¢',
                       'ðŸ¡', 'ðŸ§', 'ðŸ¨', 'ðŸ¦', 'ðŸ¥§', 'ðŸ°', 'ðŸŽ‚', 'ðŸ®', 'ðŸ­', 'ðŸ¬',
                       'ðŸ«', 'ðŸ¿', 'ðŸ©', 'ðŸª', 'ðŸŒ°', 'ðŸ¥œ', 'ðŸ¯', 'ðŸ¥›', 'ðŸ¼', 'â˜•',
                       'ðŸµ', 'ðŸ¥ƒ', 'ðŸ¶', 'ðŸº', 'ðŸ»', 'ðŸ¥‚', 'ðŸ·', 'ðŸ¥¤', 'ðŸ§ƒ', 'ðŸ§‰',
                       'ðŸ§Š', 'ðŸ¥¢', 'ðŸ½', 'ðŸ´', 'ðŸ¥„', 'ðŸ”ª', 'ðŸº', 'ðŸŒ', 'ðŸŒŽ', 'ðŸŒ',
                       'ðŸŒ', 'ðŸ—º', 'ðŸ§­', 'ðŸ”', 'â›°', 'ðŸŒ‹', 'ðŸ—»', 'ðŸ•', 'ðŸ–', 'ðŸœ',
                       'ðŸ', 'ðŸž', 'ðŸŸ', 'ðŸ›', 'ðŸ—', 'ðŸ§±', 'ðŸ˜', 'ðŸš', 'ðŸ ', 'ðŸ¡',
                       'ðŸ¢', 'ðŸ£', 'ðŸ¤', 'ðŸ¥', 'ðŸ¦', 'ðŸ¨', 'ðŸ©', 'ðŸª', 'ðŸ«', 'ðŸ¬',
                       'ðŸ­', 'ðŸ¯', 'ðŸ°', 'ðŸ’’', 'ðŸ—¼', 'ðŸ—½', 'â›ª', 'ðŸ•Œ', 'ðŸ›•', 'ðŸ•',
                       'â›©', 'ðŸ•‹', 'â›²', 'â›º', 'ðŸŒ', 'ðŸŒƒ', 'ðŸ™', 'ðŸŒ„', 'ðŸŒ…', 'ðŸŒ†',
                       'ðŸŒ‡', 'ðŸŒ‰', 'â™¨ï¸', 'ðŸŽ ', 'ðŸŽ¡', 'ðŸŽ¢', 'ðŸ’ˆ', 'ðŸŽª', 'ðŸš‚', 'ðŸšƒ',
                       'ðŸš„', 'ðŸš…', 'ðŸš†', 'ðŸš‡', 'ðŸšˆ', 'ðŸš‰', 'ðŸšŠ', 'ðŸš', 'ðŸšž', 'ðŸš‹',
                       'ðŸšŒ', 'ðŸš', 'ðŸšŽ', 'ðŸš', 'ðŸš‘', 'ðŸš’', 'ðŸš“', 'ðŸš”', 'ðŸš•', 'ðŸš–',
                       'ðŸš—', 'ðŸš˜', 'ðŸš™', 'ðŸšš', 'ðŸš›', 'ðŸšœ', 'ðŸŽ', 'ðŸ', 'ðŸ›µ', 'ðŸš²',
                       'ðŸ›´', 'ðŸ›¹', 'ðŸ›¼', 'ðŸš', 'ðŸ›¸', 'âœˆï¸', 'ðŸ›«', 'ðŸ›¬', 'ðŸª‚', 'ðŸ’º',
                       'ðŸš€', 'ðŸšŸ', 'ðŸš ', 'ðŸš¡', 'ðŸ›°', 'ðŸš¢', 'â›µ', 'ðŸ›¶', 'ðŸš¤', 'ðŸ›¥',
                       'ðŸ›³', 'â›´', 'ðŸš¢', 'âš“', 'â›½', 'ðŸš§', 'ðŸš¦', 'ðŸš¥', 'ðŸ—º', 'ðŸ—¿',
                       'ðŸ›‚', 'ðŸ›ƒ', 'ðŸ›„', 'ðŸ›…', 'âš ï¸', 'ðŸš¸', 'â›”', 'ðŸš«', 'ðŸš³', 'ðŸš­',
                       'ðŸš¯', 'ðŸš±', 'ðŸš·', 'ðŸ“µ', 'ðŸ”ž', 'â˜¢ï¸', 'â˜£ï¸', 'â¬†ï¸', 'â†—ï¸', 'âž¡ï¸',
                       'â†˜ï¸', 'â¬‡ï¸', 'â†™ï¸', 'â¬…ï¸', 'â†–ï¸', 'â†•ï¸', 'â†”ï¸', 'â†©ï¸', 'â†ªï¸', 'â¤´ï¸',
                       'â¤µï¸', 'ðŸ”ƒ', 'ðŸ”„', 'ðŸ”™', 'ðŸ”š', 'ðŸ”›', 'ðŸ”œ', 'ðŸ”', 'ðŸ›', 'âš›ï¸',
                       'ðŸ•‰', 'âœ¡ï¸', 'â˜¸ï¸', 'â˜¯ï¸', 'âœï¸', 'â˜¦ï¸', 'â˜ªï¸', 'â˜®ï¸', 'ðŸ•Ž', 'ðŸ”¯',
                       'â™ˆ', 'â™‰', 'â™Š', 'â™‹', 'â™Œ', 'â™', 'â™Ž', 'â™', 'â™', 'â™‘',
                       'â™’', 'â™“', 'â›Ž', 'ðŸ”€', 'ðŸ”', 'ðŸ”‚', 'â–¶ï¸', 'â©', 'â­', 'â¯',
                       'â¸', 'â¹', 'âº', 'â»', 'â¼', 'â½', 'â¾', 'â¿', 'ðŸ”…', 'ðŸ”†',
                       'ðŸ“¶', 'ðŸ“³', 'ðŸ“´', 'â™»ï¸', 'ðŸ”±', 'ðŸ“›', 'ðŸ”°', 'â­•', 'âœ…', 'â˜‘ï¸',
                       'âœ”ï¸', 'âœ–ï¸', 'âŒ', 'âŽ', 'âž•', 'âž–', 'âž—', 'âž°', 'âž¿', 'ã€½ï¸',
                       'âœ³ï¸', 'âœ´ï¸', 'â‡ï¸', 'â€¼ï¸', 'â‰ï¸', 'â“', 'â”', 'â•', 'â—', 'ã€°ï¸',
                       'ðŸ’±', 'ðŸ’²', 'ðŸ”±', 'ðŸ”°', 'âšª', 'âš«', 'ðŸ”´', 'ðŸ”µ', 'ðŸŸ ', 'ðŸŸ¡',
                       'ðŸŸ¢', 'ðŸŸ£', 'ðŸŸ¤', 'âš«', 'ðŸ”¶', 'ðŸ”·', 'ðŸ”¸', 'ðŸ”¹', 'ðŸ”º', 'ðŸ”»',
                       'ðŸ’ ', 'ðŸ”˜', 'ðŸ”³', 'ðŸ”²', 'â–ªï¸', 'â–«ï¸', 'â—¾', 'â—½', 'â—¼ï¸', 'â—»ï¸',
                       'ðŸŸ¥', 'ðŸŸ§', 'ðŸŸ¨', 'ðŸŸ©', 'ðŸŸ¦', 'ðŸŸª', 'ðŸŸ«', 'â¬›', 'â¬œ', 'ðŸ”ˆ',
                       'ðŸ”‡', 'ðŸ”‰', 'ðŸ”Š', 'ðŸ””', 'ðŸ”•', 'ðŸ“£', 'ðŸ“¢', 'ðŸ’¬', 'ðŸ’­', 'ðŸ—¯',
                       'ðŸ’­', 'ðŸ—¨', 'ðŸ‘â€ðŸ—¨', 'â™ ï¸', 'â™£ï¸', 'â™¥ï¸', 'â™¦ï¸', 'ðŸƒ', 'ðŸŽ´', 'ðŸ€„',
                       'ðŸ•', 'ðŸ•‘', 'ðŸ•’', 'ðŸ•“', 'ðŸ•”', 'ðŸ••', 'ðŸ•–', 'ðŸ•—', 'ðŸ•˜', 'ðŸ•™',
                       'ðŸ•š', 'ðŸ•›', 'ðŸ•œ', 'ðŸ•', 'ðŸ•ž', 'ðŸ•Ÿ', 'ðŸ• ', 'ðŸ•¡', 'ðŸ•¢', 'ðŸ•£',
                       'ðŸ•¤', 'ðŸ•¥', 'ðŸ•¦', 'ðŸ•§', 'ðŸ³', 'ðŸ´', 'ðŸ', 'ðŸš©', 'ðŸ³ï¸â€ðŸŒˆ', 'ðŸ³ï¸â€âš§ï¸',
                       'ðŸ‡¦ðŸ‡¨', 'ðŸ‡¦ðŸ‡©', 'ðŸ‡¦ðŸ‡ª', 'ðŸ‡¦ðŸ‡«', 'ðŸ‡¦ðŸ‡¬', 'ðŸ‡¦ðŸ‡®', 'ðŸ‡¦ðŸ‡±', 'ðŸ‡¦ðŸ‡²', 'ðŸ‡¦ðŸ‡´', 'ðŸ‡¦ðŸ‡¶',
                       'ðŸ‡¦ðŸ‡·', 'ðŸ‡¦ðŸ‡¸', 'ðŸ‡¦ðŸ‡¹', 'ðŸ‡¦ðŸ‡º', 'ðŸ‡¦ðŸ‡¼', 'ðŸ‡¦ðŸ‡½', 'ðŸ‡¦ðŸ‡¿', 'ðŸ‡§ðŸ‡¦', 'ðŸ‡§ðŸ‡§', 'ðŸ‡§ðŸ‡©',
                       'ðŸ‡§ðŸ‡ª', 'ðŸ‡§ðŸ‡«', 'ðŸ‡§ðŸ‡¬', 'ðŸ‡§ðŸ‡­', 'ðŸ‡§ðŸ‡®', 'ðŸ‡§ðŸ‡¯', 'ðŸ‡§ðŸ‡±', 'ðŸ‡§ðŸ‡²', 'ðŸ‡§ðŸ‡³', 'ðŸ‡§ðŸ‡´',
                       'ðŸ‡§ðŸ‡¶', 'ðŸ‡§ðŸ‡·', 'ðŸ‡§ðŸ‡¸', 'ðŸ‡§ðŸ‡¹', 'ðŸ‡§ðŸ‡»', 'ðŸ‡§ðŸ‡¼', 'ðŸ‡§ðŸ‡¾', 'ðŸ‡§ðŸ‡¿', 'ðŸ‡¨ðŸ‡¦', 'ðŸ‡¨ðŸ‡¨',
                       'ðŸ‡¨ðŸ‡©', 'ðŸ‡¨ðŸ‡«', 'ðŸ‡¨ðŸ‡¬', 'ðŸ‡¨ðŸ‡­', 'ðŸ‡¨ðŸ‡®', 'ðŸ‡¨ðŸ‡°', 'ðŸ‡¨ðŸ‡±', 'ðŸ‡¨ðŸ‡²', 'ðŸ‡¨ðŸ‡³', 'ðŸ‡¨ðŸ‡´',
                       'ðŸ‡¨ðŸ‡µ', 'ðŸ‡¨ðŸ‡·', 'ðŸ‡¨ðŸ‡º', 'ðŸ‡¨ðŸ‡»', 'ðŸ‡¨ðŸ‡¼', 'ðŸ‡¨ðŸ‡½', 'ðŸ‡¨ðŸ‡¾', 'ðŸ‡¨ðŸ‡¿', 'ðŸ‡©ðŸ‡ª', 'ðŸ‡©ðŸ‡¬',
                       'ðŸ‡©ðŸ‡¯', 'ðŸ‡©ðŸ‡°', 'ðŸ‡©ðŸ‡²', 'ðŸ‡©ðŸ‡´', 'ðŸ‡©ðŸ‡¿', 'ðŸ‡ªðŸ‡¦', 'ðŸ‡ªðŸ‡¨', 'ðŸ‡ªðŸ‡ª', 'ðŸ‡ªðŸ‡¬', 'ðŸ‡ªðŸ‡­',
                       'ðŸ‡ªðŸ‡·', 'ðŸ‡ªðŸ‡¸', 'ðŸ‡ªðŸ‡¹', 'ðŸ‡ªðŸ‡º', 'ðŸ‡«ðŸ‡®', 'ðŸ‡«ðŸ‡¯', 'ðŸ‡«ðŸ‡°', 'ðŸ‡«ðŸ‡²', 'ðŸ‡«ðŸ‡´', 'ðŸ‡«ðŸ‡·',
                       'ðŸ‡¬ðŸ‡¦', 'ðŸ‡¬ðŸ‡§', 'ðŸ‡¬ðŸ‡©', 'ðŸ‡¬ðŸ‡ª', 'ðŸ‡¬ðŸ‡«', 'ðŸ‡¬ðŸ‡¬', 'ðŸ‡¬ðŸ‡­', 'ðŸ‡¬ðŸ‡®', 'ðŸ‡¬ðŸ‡±', 'ðŸ‡¬ðŸ‡²',
                       'ðŸ‡¬ðŸ‡³', 'ðŸ‡¬ðŸ‡µ', 'ðŸ‡¬ðŸ‡¶', 'ðŸ‡¬ðŸ‡·', 'ðŸ‡¬ðŸ‡¸', 'ðŸ‡¬ðŸ‡¹', 'ðŸ‡¬ðŸ‡º', 'ðŸ‡¬ðŸ‡¼', 'ðŸ‡¬ðŸ‡¾', 'ðŸ‡­ðŸ‡°',
                       'ðŸ‡­ðŸ‡²', 'ðŸ‡­ðŸ‡³', 'ðŸ‡­ðŸ‡·', 'ðŸ‡­ðŸ‡¹', 'ðŸ‡­ðŸ‡º', 'ðŸ‡®ðŸ‡©', 'ðŸ‡®ðŸ‡ª', 'ðŸ‡®ðŸ‡±', 'ðŸ‡®ðŸ‡²', 'ðŸ‡®ðŸ‡³',
                       'ðŸ‡®ðŸ‡´', 'ðŸ‡®ðŸ‡¶', 'ðŸ‡®ðŸ‡·', 'ðŸ‡®ðŸ‡¸', 'ðŸ‡®ðŸ‡¹', 'ðŸ‡¯ðŸ‡ª', 'ðŸ‡¯ðŸ‡²', 'ðŸ‡¯ðŸ‡´', 'ðŸ‡¯ðŸ‡µ', 'ðŸ‡°ðŸ‡ª',
                       'ðŸ‡°ðŸ‡¬', 'ðŸ‡°ðŸ‡­', 'ðŸ‡°ðŸ‡®', 'ðŸ‡°ðŸ‡²', 'ðŸ‡°ðŸ‡³', 'ðŸ‡°ðŸ‡µ', 'ðŸ‡°ðŸ‡·', 'ðŸ‡°ðŸ‡¼', 'ðŸ‡°ðŸ‡¾', 'ðŸ‡°ðŸ‡¿',
                       'ðŸ‡±ðŸ‡¦', 'ðŸ‡±ðŸ‡§', 'ðŸ‡±ðŸ‡¨', 'ðŸ‡±ðŸ‡®', 'ðŸ‡±ðŸ‡°', 'ðŸ‡±ðŸ‡·', 'ðŸ‡±ðŸ‡¸', 'ðŸ‡±ðŸ‡¹', 'ðŸ‡±ðŸ‡º', 'ðŸ‡±ðŸ‡»',
                       'ðŸ‡±ðŸ‡¾', 'ðŸ‡²ðŸ‡¦', 'ðŸ‡²ðŸ‡¨', 'ðŸ‡²ðŸ‡©', 'ðŸ‡²ðŸ‡ª', 'ðŸ‡²ðŸ‡«', 'ðŸ‡²ðŸ‡¬', 'ðŸ‡²ðŸ‡­', 'ðŸ‡²ðŸ‡°', 'ðŸ‡²ðŸ‡±',
                       'ðŸ‡²ðŸ‡²', 'ðŸ‡²ðŸ‡³', 'ðŸ‡²ðŸ‡´', 'ðŸ‡²ðŸ‡µ', 'ðŸ‡²ðŸ‡¶', 'ðŸ‡²ðŸ‡·', 'ðŸ‡²ðŸ‡¸', 'ðŸ‡²ðŸ‡¹', 'ðŸ‡²ðŸ‡º', 'ðŸ‡²ðŸ‡»',
                       'ðŸ‡²ðŸ‡¼', 'ðŸ‡²ðŸ‡½', 'ðŸ‡²ðŸ‡¾', 'ðŸ‡²ðŸ‡¿', 'ðŸ‡³ðŸ‡¦', 'ðŸ‡³ðŸ‡¨', 'ðŸ‡³ðŸ‡ª', 'ðŸ‡³ðŸ‡«', 'ðŸ‡³ðŸ‡¬', 'ðŸ‡³ðŸ‡®',
                       'ðŸ‡³ðŸ‡±', 'ðŸ‡³ðŸ‡´', 'ðŸ‡³ðŸ‡µ', 'ðŸ‡³ðŸ‡·', 'ðŸ‡³ðŸ‡º', 'ðŸ‡³ðŸ‡¿', 'ðŸ‡´ðŸ‡²', 'ðŸ‡µðŸ‡¦', 'ðŸ‡µðŸ‡ª', 'ðŸ‡µðŸ‡«',
                       'ðŸ‡µðŸ‡¬', 'ðŸ‡µðŸ‡­', 'ðŸ‡µðŸ‡°', 'ðŸ‡µðŸ‡±', 'ðŸ‡µðŸ‡²', 'ðŸ‡µðŸ‡³', 'ðŸ‡µðŸ‡·', 'ðŸ‡µðŸ‡¸', 'ðŸ‡µðŸ‡¹', 'ðŸ‡µðŸ‡¼',
                       'ðŸ‡µðŸ‡¾', 'ðŸ‡¶ðŸ‡¦', 'ðŸ‡·ðŸ‡ª', 'ðŸ‡·ðŸ‡´', 'ðŸ‡·ðŸ‡¸', 'ðŸ‡·ðŸ‡º', 'ðŸ‡·ðŸ‡¼', 'ðŸ‡¸ðŸ‡¦', 'ðŸ‡¸ðŸ‡§', 'ðŸ‡¸ðŸ‡¨',
                       'ðŸ‡¸ðŸ‡©', 'ðŸ‡¸ðŸ‡ª', 'ðŸ‡¸ðŸ‡¬', 'ðŸ‡¸ðŸ‡­', 'ðŸ‡¸ðŸ‡®', 'ðŸ‡¸ðŸ‡¯', 'ðŸ‡¸ðŸ‡°', 'ðŸ‡¸ðŸ‡±', 'ðŸ‡¸ðŸ‡²', 'ðŸ‡¸ðŸ‡³',
                       'ðŸ‡¸ðŸ‡´', 'ðŸ‡¸ðŸ‡·', 'ðŸ‡¸ðŸ‡¸', 'ðŸ‡¸ðŸ‡¹', 'ðŸ‡¸ðŸ‡»', 'ðŸ‡¸ðŸ‡½', 'ðŸ‡¸ðŸ‡¾', 'ðŸ‡¸ðŸ‡¿', 'ðŸ‡¹ðŸ‡¦', 'ðŸ‡¹ðŸ‡¨',
                       'ðŸ‡¹ðŸ‡©', 'ðŸ‡¹ðŸ‡«', 'ðŸ‡¹ðŸ‡¬', 'ðŸ‡¹ðŸ‡­', 'ðŸ‡¹ðŸ‡¯', 'ðŸ‡¹ðŸ‡°', 'ðŸ‡¹ðŸ‡±', 'ðŸ‡¹ðŸ‡²', 'ðŸ‡¹ðŸ‡³', 'ðŸ‡¹ðŸ‡´',
                       'ðŸ‡¹ðŸ‡·', 'ðŸ‡¹ðŸ‡¹', 'ðŸ‡¹ðŸ‡»', 'ðŸ‡¹ðŸ‡¼', 'ðŸ‡¹ðŸ‡¿', 'ðŸ‡ºðŸ‡¦', 'ðŸ‡ºðŸ‡¬', 'ðŸ‡ºðŸ‡²', 'ðŸ‡ºðŸ‡³', 'ðŸ‡ºðŸ‡¸',
                       'ðŸ‡ºðŸ‡¾', 'ðŸ‡ºðŸ‡¿', 'ðŸ‡»ðŸ‡¦', 'ðŸ‡»ðŸ‡¨', 'ðŸ‡»ðŸ‡ª', 'ðŸ‡»ðŸ‡¬', 'ðŸ‡»ðŸ‡®', 'ðŸ‡»ðŸ‡³', 'ðŸ‡»ðŸ‡º', 'ðŸ‡¼ðŸ‡«',
                       'ðŸ‡¼ðŸ‡¸', 'ðŸ‡½ðŸ‡°', 'ðŸ‡¾ðŸ‡ª', 'ðŸ‡¾ðŸ‡¹', 'ðŸ‡¿ðŸ‡¦', 'ðŸ‡¿ðŸ‡²', 'ðŸ‡¿ðŸ‡¼', 'ðŸ´â€â˜ ï¸', 'ðŸ‡¦ðŸ‡«', 'ðŸ‡¦ðŸ‡½',
                       'ðŸ‡¦ðŸ‡±', 'ðŸ‡©ðŸ‡¿', 'ðŸ‡¦ðŸ‡¸', 'ðŸ‡¦ðŸ‡©', 'ðŸ‡¦ðŸ‡´', 'ðŸ‡¦ðŸ‡®', 'ðŸ‡¦ðŸ‡¶', 'ðŸ‡¦ðŸ‡¬', 'ðŸ‡¦ðŸ‡·', 'ðŸ‡¦ðŸ‡²',
                       'ðŸ‡¦ðŸ‡¼', 'ðŸ‡¦ðŸ‡º', 'ðŸ‡¦ðŸ‡¹', 'ðŸ‡¦ðŸ‡¿', 'ðŸ‡§ðŸ‡¸', 'ðŸ‡§ðŸ‡­', 'ðŸ‡§ðŸ‡©', 'ðŸ‡§ðŸ‡§', 'ðŸ‡§ðŸ‡¾', 'ðŸ‡§ðŸ‡ª',
                       'ðŸ‡§ðŸ‡¿', 'ðŸ‡§ðŸ‡¯', 'ðŸ‡§ðŸ‡²', 'ðŸ‡§ðŸ‡¹', 'ðŸ‡§ðŸ‡´', 'ðŸ‡§ðŸ‡¦', 'ðŸ‡§ðŸ‡¼', 'ðŸ‡§ðŸ‡·', 'ðŸ‡®ðŸ‡´', 'ðŸ‡»ðŸ‡¬',
                       'ðŸ‡§ðŸ‡³', 'ðŸ‡§ðŸ‡¬', 'ðŸ‡§ðŸ‡«', 'ðŸ‡§ðŸ‡®', 'ðŸ‡¨ðŸ‡»', 'ðŸ‡°ðŸ‡­', 'ðŸ‡¨ðŸ‡²', 'ðŸ‡¨ðŸ‡¦', 'ðŸ‡°ðŸ‡¾', 'ðŸ‡¨ðŸ‡«',
                       'ðŸ‡¹ðŸ‡©', 'ðŸ‡¨ðŸ‡±', 'ðŸ‡¨ðŸ‡³', 'ðŸ‡¨ðŸ‡½', 'ðŸ‡¨ðŸ‡¨', 'ðŸ‡¨ðŸ‡´', 'ðŸ‡°ðŸ‡²', 'ðŸ‡¨ðŸ‡¬', 'ðŸ‡¨ðŸ‡©', 'ðŸ‡¨ðŸ‡°',
                       'ðŸ‡¨ðŸ‡·', 'ðŸ‡¨ðŸ‡®', 'ðŸ‡­ðŸ‡·', 'ðŸ‡¨ðŸ‡º', 'ðŸ‡¨ðŸ‡¼', 'ðŸ‡¨ðŸ‡¾', 'ðŸ‡¨ðŸ‡¿', 'ðŸ‡©ðŸ‡°', 'ðŸ‡©ðŸ‡¯', 'ðŸ‡©ðŸ‡²',
                       'ðŸ‡©ðŸ‡´', 'ðŸ‡ªðŸ‡¨', 'ðŸ‡ªðŸ‡¬', 'ðŸ‡¸ðŸ‡»', 'ðŸ‡¬ðŸ‡¶', 'ðŸ‡ªðŸ‡·', 'ðŸ‡ªðŸ‡ª', 'ðŸ‡ªðŸ‡¹', 'ðŸ‡ªðŸ‡º', 'ðŸ‡«ðŸ‡°',
                       'ðŸ‡«ðŸ‡´', 'ðŸ‡«ðŸ‡¯', 'ðŸ‡«ðŸ‡®', 'ðŸ‡«ðŸ‡·', 'ðŸ‡¬ðŸ‡«', 'ðŸ‡µðŸ‡«', 'ðŸ‡¹ðŸ‡«', 'ðŸ‡¬ðŸ‡¦', 'ðŸ‡¬ðŸ‡²', 'ðŸ‡¬ðŸ‡ª',
                       'ðŸ‡©ðŸ‡ª', 'ðŸ‡¬ðŸ‡­', 'ðŸ‡¬ðŸ‡®', 'ðŸ‡¬ðŸ‡·', 'ðŸ‡¬ðŸ‡±', 'ðŸ‡¬ðŸ‡©', 'ðŸ‡¬ðŸ‡µ', 'ðŸ‡¬ðŸ‡º', 'ðŸ‡¬ðŸ‡¹', 'ðŸ‡¬ðŸ‡¬',
                       'ðŸ‡¬ðŸ‡³', 'ðŸ‡¬ðŸ‡¼', 'ðŸ‡¬ðŸ‡¾', 'ðŸ‡­ðŸ‡¹', 'ðŸ‡­ðŸ‡³', 'ðŸ‡­ðŸ‡°', 'ðŸ‡­ðŸ‡º', 'ðŸ‡®ðŸ‡¸', 'ðŸ‡®ðŸ‡³', 'ðŸ‡®ðŸ‡©',
                       'ðŸ‡®ðŸ‡·', 'ðŸ‡®ðŸ‡¶', 'ðŸ‡®ðŸ‡ª', 'ðŸ‡®ðŸ‡²', 'ðŸ‡®ðŸ‡±', 'ðŸ‡®ðŸ‡¹', 'ðŸ‡¯ðŸ‡²', 'ðŸ‡¯ðŸ‡µ', 'ðŸ‡¯ðŸ‡ª', 'ðŸ‡¯ðŸ‡´',
                       'ðŸ‡°ðŸ‡¿', 'ðŸ‡°ðŸ‡ª', 'ðŸ‡°ðŸ‡®', 'ðŸ‡°ðŸ‡µ', 'ðŸ‡°ðŸ‡·', 'ðŸ‡°ðŸ‡¼', 'ðŸ‡°ðŸ‡¬', 'ðŸ‡±ðŸ‡¦', 'ðŸ‡±ðŸ‡»', 'ðŸ‡±ðŸ‡§',
                       'ðŸ‡±ðŸ‡¸', 'ðŸ‡±ðŸ‡·', 'ðŸ‡±ðŸ‡¾', 'ðŸ‡±ðŸ‡®', 'ðŸ‡±ðŸ‡¹', 'ðŸ‡±ðŸ‡º', 'ðŸ‡²ðŸ‡´', 'ðŸ‡²ðŸ‡°', 'ðŸ‡²ðŸ‡¬', 'ðŸ‡²ðŸ‡¼',
                       'ðŸ‡²ðŸ‡¾', 'ðŸ‡²ðŸ‡»', 'ðŸ‡²ðŸ‡±', 'ðŸ‡²ðŸ‡¹', 'ðŸ‡²ðŸ‡­', 'ðŸ‡²ðŸ‡¶', 'ðŸ‡²ðŸ‡·', 'ðŸ‡²ðŸ‡º', 'ðŸ‡¾ðŸ‡¹', 'ðŸ‡²ðŸ‡½',
                       'ðŸ‡«ðŸ‡²', 'ðŸ‡²ðŸ‡©', 'ðŸ‡²ðŸ‡¨', 'ðŸ‡²ðŸ‡³', 'ðŸ‡²ðŸ‡ª', 'ðŸ‡²ðŸ‡¸', 'ðŸ‡²ðŸ‡¦', 'ðŸ‡²ðŸ‡¿', 'ðŸ‡²ðŸ‡²', 'ðŸ‡³ðŸ‡¦',
                       'ðŸ‡³ðŸ‡·', 'ðŸ‡³ðŸ‡µ', 'ðŸ‡³ðŸ‡±', 'ðŸ‡³ðŸ‡¨', 'ðŸ‡³ðŸ‡¿', 'ðŸ‡³ðŸ‡®', 'ðŸ‡³ðŸ‡ª', 'ðŸ‡³ðŸ‡¬', 'ðŸ‡³ðŸ‡º', 'ðŸ‡³ðŸ‡«',
                       'ðŸ‡°ðŸ‡µ', 'ðŸ‡²ðŸ‡µ', 'ðŸ‡³ðŸ‡´', 'ðŸ‡´ðŸ‡²', 'ðŸ‡µðŸ‡°', 'ðŸ‡µðŸ‡¼', 'ðŸ‡µðŸ‡¸', 'ðŸ‡µðŸ‡¦', 'ðŸ‡µðŸ‡¬', 'ðŸ‡µðŸ‡¾',
                       'ðŸ‡µðŸ‡ª', 'ðŸ‡µðŸ‡­', 'ðŸ‡µðŸ‡³', 'ðŸ‡µðŸ‡±', 'ðŸ‡µðŸ‡¹', 'ðŸ‡µðŸ‡·', 'ðŸ‡¶ðŸ‡¦', 'ðŸ‡·ðŸ‡ª', 'ðŸ‡·ðŸ‡´', 'ðŸ‡·ðŸ‡º',
                       'ðŸ‡·ðŸ‡¼', 'ðŸ‡¼ðŸ‡¸', 'ðŸ‡¸ðŸ‡²', 'ðŸ‡¸ðŸ‡¹', 'ðŸ‡¸ðŸ‡¦', 'ðŸ‡¸ðŸ‡³', 'ðŸ‡·ðŸ‡¸', 'ðŸ‡¸ðŸ‡¨', 'ðŸ‡¸ðŸ‡±', 'ðŸ‡¸ðŸ‡¬',
                       'ðŸ‡¸ðŸ‡½', 'ðŸ‡¸ðŸ‡°', 'ðŸ‡¸ðŸ‡®', 'ðŸ‡¸ðŸ‡§', 'ðŸ‡¸ðŸ‡´', 'ðŸ‡¿ðŸ‡¦', 'ðŸ‡¬ðŸ‡¸', 'ðŸ‡¸ðŸ‡¸', 'ðŸ‡ªðŸ‡¸', 'ðŸ‡±ðŸ‡°',
                       'ðŸ‡¸ðŸ‡­', 'ðŸ‡µðŸ‡²', 'ðŸ‡¸ðŸ‡©', 'ðŸ‡¸ðŸ‡·', 'ðŸ‡¸ðŸ‡¿', 'ðŸ‡¸ðŸ‡ª', 'ðŸ‡¨ðŸ‡­', 'ðŸ‡¸ðŸ‡¾', 'ðŸ‡¹ðŸ‡¼', 'ðŸ‡¹ðŸ‡¯',
                       'ðŸ‡¹ðŸ‡¿', 'ðŸ‡¹ðŸ‡­', 'ðŸ‡¹ðŸ‡±', 'ðŸ‡¹ðŸ‡¬', 'ðŸ‡¹ðŸ‡°', 'ðŸ‡¹ðŸ‡´', 'ðŸ‡¹ðŸ‡¹', 'ðŸ‡¹ðŸ‡³', 'ðŸ‡¹ðŸ‡·', 'ðŸ‡¹ðŸ‡²',
                       'ðŸ‡¹ðŸ‡¨', 'ðŸ‡¹ðŸ‡»', 'ðŸ‡ºðŸ‡¬', 'ðŸ‡ºðŸ‡¦', 'ðŸ‡¦ðŸ‡ª', 'ðŸ‡¬ðŸ‡§', 'ðŸ‡ºðŸ‡¸', 'ðŸ‡ºðŸ‡²', 'ðŸ‡ºðŸ‡¾', 'ðŸ‡ºðŸ‡¿',
                       'ðŸ‡»ðŸ‡º', 'ðŸ‡»ðŸ‡¦', 'ðŸ‡»ðŸ‡ª', 'ðŸ‡»ðŸ‡³', 'ðŸ‡»ðŸ‡¬', 'ðŸ‡»ðŸ‡®', 'ðŸ‡¼ðŸ‡«', 'ðŸ‡ªðŸ‡­', 'ðŸ‡¾ðŸ‡ª', 'ðŸ‡¿ðŸ‡²',
                       'ðŸ‡¿ðŸ‡¼', 'ðŸ´', 'ðŸ³', 'ðŸ³ï¸â€ðŸŒˆ', 'ðŸ³ï¸â€âš§ï¸', 'ðŸ‡ºðŸ‡³', 'ðŸ‡¦ðŸ‡«', 'ðŸ‡¦ðŸ‡½', 'ðŸ‡¦ðŸ‡±', 'ðŸ‡©ðŸ‡¿',
                       'ðŸ‡¦ðŸ‡¸', 'ðŸ‡¦ðŸ‡©', 'ðŸ‡¦ðŸ‡´', 'ðŸ‡¦ðŸ‡®', 'ðŸ‡¦ðŸ‡¶', 'ðŸ‡¦ðŸ‡¬', 'ðŸ‡¦ðŸ‡·', 'ðŸ‡¦ðŸ‡²', 'ðŸ‡¦ðŸ‡¼', 'ðŸ‡¦ðŸ‡º',
                       'ðŸ‡¦ðŸ‡¹', 'ðŸ‡¦ðŸ‡¿', 'ðŸ‡§ðŸ‡¸', 'ðŸ‡§ðŸ‡­', 'ðŸ‡§ðŸ‡©', 'ðŸ‡§ðŸ‡§', 'ðŸ‡§ðŸ‡¾', 'ðŸ‡§ðŸ‡ª', 'ðŸ‡§ðŸ‡¿', 'ðŸ‡§ðŸ‡¯',
                       'ðŸ‡§ðŸ‡²', 'ðŸ‡§ðŸ‡¹', 'ðŸ‡§ðŸ‡´', 'ðŸ‡§ðŸ‡¦', 'ðŸ‡§ðŸ‡¼', 'ðŸ‡§ðŸ‡·', 'ðŸ‡®ðŸ‡´', 'ðŸ‡»ðŸ‡¬', 'ðŸ‡§ðŸ‡³', 'ðŸ‡§ðŸ‡¬',
                       'ðŸ‡§ðŸ‡«', 'ðŸ‡§ðŸ‡®', 'ðŸ‡¨ðŸ‡»', 'ðŸ‡°ðŸ‡­', 'ðŸ‡¨ðŸ‡²', 'ðŸ‡¨ðŸ‡¦', 'ðŸ‡°ðŸ‡¾', 'ðŸ‡¨ðŸ‡«', 'ðŸ‡¹ðŸ‡©', 'ðŸ‡¨ðŸ‡±',
                       'ðŸ‡¨ðŸ‡³', 'ðŸ‡¨ðŸ‡½', 'ðŸ‡¨ðŸ‡¨', 'ðŸ‡¨ðŸ‡´', 'ðŸ‡°ðŸ‡²', 'ðŸ‡¨ðŸ‡¬', 'ðŸ‡¨ðŸ‡©', 'ðŸ‡¨ðŸ‡°', 'ðŸ‡¨ðŸ‡·', 'ðŸ‡¨ðŸ‡®',
                       'ðŸ‡­ðŸ‡·', 'ðŸ‡¨ðŸ‡º', 'ðŸ‡¨ðŸ‡¼', 'ðŸ‡¨ðŸ‡¾', 'ðŸ‡¨ðŸ‡¿', 'ðŸ‡©ðŸ‡°', 'ðŸ‡©ðŸ‡¯', 'ðŸ‡©ðŸ‡²', 'ðŸ‡©ðŸ‡´', 'ðŸ‡ªðŸ‡¨',
                       'ðŸ‡ªðŸ‡¬', 'ðŸ‡¸ðŸ‡»', 'ðŸ‡¬ðŸ‡¶', 'ðŸ‡ªðŸ‡·', 'ðŸ‡ªðŸ‡ª', 'ðŸ‡ªðŸ‡¹', 'ðŸ‡ªðŸ‡º', 'ðŸ‡«ðŸ‡°', 'ðŸ‡«ðŸ‡´', 'ðŸ‡«ðŸ‡¯',
                       'ðŸ‡«ðŸ‡®', 'ðŸ‡«ðŸ‡·', 'ðŸ‡¬ðŸ‡«', 'ðŸ‡µðŸ‡«', 'ðŸ‡¹ðŸ‡«', 'ðŸ‡¬ðŸ‡¦', 'ðŸ‡¬ðŸ‡²', 'ðŸ‡¬ðŸ‡ª', 'ðŸ‡©ðŸ‡ª', 'ðŸ‡¬ðŸ‡­',
                       'ðŸ‡¬ðŸ‡®', 'ðŸ‡¬ðŸ‡·', 'ðŸ‡¬ðŸ‡±', 'ðŸ‡¬ðŸ‡©', 'ðŸ‡¬ðŸ‡µ', 'ðŸ‡¬ðŸ‡º', 'ðŸ‡¬ðŸ‡¹', 'ðŸ‡¬ðŸ‡¬', 'ðŸ‡¬ðŸ‡³', 'ðŸ‡¬ðŸ‡¼',
                       'ðŸ‡¬ðŸ‡¾', 'ðŸ‡­ðŸ‡¹', 'ðŸ‡­ðŸ‡³', 'ðŸ‡­ðŸ‡°', 'ðŸ‡­ðŸ‡º', 'ðŸ‡®ðŸ‡¸', 'ðŸ‡®ðŸ‡³', 'ðŸ‡®ðŸ‡©', 'ðŸ‡®ðŸ‡·', 'ðŸ‡®ðŸ‡¶',
                       'ðŸ‡®ðŸ‡ª', 'ðŸ‡®ðŸ‡²', 'ðŸ‡®ðŸ‡±', 'ðŸ‡®ðŸ‡¹', 'ðŸ‡¯ðŸ‡²', 'ðŸ‡¯ðŸ‡µ', 'ðŸ‡¯ðŸ‡ª', 'ðŸ‡¯ðŸ‡´', 'ðŸ‡°ðŸ‡¿', 'ðŸ‡°ðŸ‡ª',
                       'ðŸ‡°ðŸ‡®', 'ðŸ‡°ðŸ‡µ', 'ðŸ‡°ðŸ‡·', 'ðŸ‡°ðŸ‡¼', 'ðŸ‡°ðŸ‡¬', 'ðŸ‡±ðŸ‡¦', 'ðŸ‡±ðŸ‡»', 'ðŸ‡±ðŸ‡§', 'ðŸ‡±ðŸ‡¸', 'ðŸ‡±ðŸ‡·',
                       'ðŸ‡±ðŸ‡¾', 'ðŸ‡±ðŸ‡®', 'ðŸ‡±ðŸ‡¹', 'ðŸ‡±ðŸ‡º', 'ðŸ‡²ðŸ‡´', 'ðŸ‡²ðŸ‡°', 'ðŸ‡²ðŸ‡¬', 'ðŸ‡²ðŸ‡¼', 'ðŸ‡²ðŸ‡¾', 'ðŸ‡²ðŸ‡»',
                       'ðŸ‡²ðŸ‡±', 'ðŸ‡²ðŸ‡¹', 'ðŸ‡²ðŸ‡­', 'ðŸ‡²ðŸ‡¶', 'ðŸ‡²ðŸ‡·', 'ðŸ‡²ðŸ‡º', 'ðŸ‡¾ðŸ‡¹', 'ðŸ‡²ðŸ‡½', 'ðŸ‡«ðŸ‡²', 'ðŸ‡²ðŸ‡©',
                       'ðŸ‡²ðŸ‡¨', 'ðŸ‡²ðŸ‡³', 'ðŸ‡²ðŸ‡ª', 'ðŸ‡²ðŸ‡¸', 'ðŸ‡²ðŸ‡¦', 'ðŸ‡²ðŸ‡¿', 'ðŸ‡²ðŸ‡²', 'ðŸ‡³ðŸ‡¦', 'ðŸ‡³ðŸ‡·', 'ðŸ‡³ðŸ‡µ',
                       'ðŸ‡³ðŸ‡±', 'ðŸ‡³ðŸ‡¨', 'ðŸ‡³ðŸ‡¿', 'ðŸ‡³ðŸ‡®', 'ðŸ‡³ðŸ‡ª', 'ðŸ‡³ðŸ‡¬', 'ðŸ‡³ðŸ‡º', 'ðŸ‡³ðŸ‡«', 'ðŸ‡°ðŸ‡µ', 'ðŸ‡²ðŸ‡µ',
                       'ðŸ‡³ðŸ‡´', 'ðŸ‡´ðŸ‡²', 'ðŸ‡µðŸ‡°', 'ðŸ‡µðŸ‡¼', 'ðŸ‡µðŸ‡¸', 'ðŸ‡µðŸ‡¦', 'ðŸ‡µðŸ‡¬', 'ðŸ‡µðŸ‡¾', 'ðŸ‡µðŸ‡ª', 'ðŸ‡µðŸ‡­',
                       'ðŸ‡µðŸ‡³', 'ðŸ‡µðŸ‡±', 'ðŸ‡µðŸ‡¹', 'ðŸ‡µðŸ‡·', 'ðŸ‡¶ðŸ‡¦', 'ðŸ‡·ðŸ‡ª', 'ðŸ‡·ðŸ‡´', 'ðŸ‡·ðŸ‡º', 'ðŸ‡·ðŸ‡¼', 'ðŸ‡¼ðŸ‡¸',
                       'ðŸ‡¸ðŸ‡²', 'ðŸ‡¸ðŸ‡¹', 'ðŸ‡¸ðŸ‡¦', 'ðŸ‡¸ðŸ‡³', 'ðŸ‡·ðŸ‡¸', 'ðŸ‡¸ðŸ‡¨', 'ðŸ‡¸ðŸ‡±', 'ðŸ‡¸ðŸ‡¬', 'ðŸ‡¸ðŸ‡½', 'ðŸ‡¸ðŸ‡°',
                       'ðŸ‡¸ðŸ‡®', 'ðŸ‡¸ðŸ‡§', 'ðŸ‡¸ðŸ‡´', 'ðŸ‡¿ðŸ‡¦', 'ðŸ‡¬ðŸ‡¸', 'ðŸ‡¸ðŸ‡¸', 'ðŸ‡ªðŸ‡¸', 'ðŸ‡±ðŸ‡°', 'ðŸ‡¸ðŸ‡­', 'ðŸ‡µðŸ‡²',
                       'ðŸ‡¸ðŸ‡©', 'ðŸ‡¸ðŸ‡·', 'ðŸ‡¸ðŸ‡¿', 'ðŸ‡¸ðŸ‡ª', 'ðŸ‡¨ðŸ‡­', 'ðŸ‡¸ðŸ‡¾', 'ðŸ‡¹ðŸ‡¼', 'ðŸ‡¹ðŸ‡¯', 'ðŸ‡¹ðŸ‡¿', 'ðŸ‡¹ðŸ‡­',
                       'ðŸ‡¹ðŸ‡±', 'ðŸ‡¹ðŸ‡¬', 'ðŸ‡¹ðŸ‡°', 'ðŸ‡¹ðŸ‡´', 'ðŸ‡¹ðŸ‡¹', 'ðŸ‡¹ðŸ‡³', 'ðŸ‡¹ðŸ‡·', 'ðŸ‡¹ðŸ‡²', 'ðŸ‡¹ðŸ‡¨', 'ðŸ‡¹ðŸ‡»',
                       'ðŸ‡ºðŸ‡¬', 'ðŸ‡ºðŸ‡¦', 'ðŸ‡¦ðŸ‡ª', 'ðŸ‡¬ðŸ‡§', 'ðŸ‡ºðŸ‡¸', 'ðŸ‡ºðŸ‡²', 'ðŸ‡ºðŸ‡¾', 'ðŸ‡ºðŸ‡¿', 'ðŸ‡»ðŸ‡º', 'ðŸ‡»ðŸ‡¦',
                       'ðŸ‡»ðŸ‡ª', 'ðŸ‡»ðŸ‡³', 'ðŸ‡»ðŸ‡¬', 'ðŸ‡»ðŸ‡®', 'ðŸ‡¼ðŸ‡«', 'ðŸ‡ªðŸ‡­', 'ðŸ‡¾ðŸ‡ª', 'ðŸ‡¿ðŸ‡²', 'ðŸ‡¿ðŸ‡¼', 'ðŸ´',
                       'ðŸ³', 'ðŸ³ï¸â€ðŸŒˆ', 'ðŸ³ï¸â€âš§ï¸', 'ðŸ‡ºðŸ‡³'];

        emojiPicker.innerHTML = emojis.map(emoji => 
            `<button type="button" class="emoji-btn" onclick="chatPanel.insertEmoji('${emoji}')" aria-label="Insert ${emoji}">${emoji}</button>`
        ).join('');
    }

    attachEventListeners() {
        // File upload handler
        const fileInput = document.getElementById('chatFileInput');
        if (fileInput) {
            fileInput.addEventListener('change', (e) => this.handleFileUpload(e));
        }

        // Auto-resize textarea
        const chatInput = document.getElementById('chatInput');
        if (chatInput) {
            chatInput.addEventListener('input', () => {
                chatInput.style.height = 'auto';
                chatInput.style.height = Math.min(chatInput.scrollHeight, 120) + 'px';
            });
        }

        // Scroll detection
        const messagesContainer = document.getElementById('chatMessagesContainer');
        if (messagesContainer) {
            messagesContainer.addEventListener('scroll', () => this.handleScroll());
        }
    }

    switchMode(mode) {
        this.chatMode = mode;
        const recipientSelect = document.getElementById('privateChatRecipient');
        if (recipientSelect) {
            recipientSelect.classList.toggle('hidden', mode === 'group');
            if (mode === 'group') {
                this.privateRecipientId = null;
                recipientSelect.value = '';
            }
        }
        
        // Update button states
        document.querySelectorAll('.chat-mode-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.mode === mode);
        });

        this.loadMessages();
    }

    selectRecipient(userId) {
        this.privateRecipientId = userId || null;
        this.loadMessages();
    }

    loadMessages() {
        const messagesContainer = document.getElementById('chatMessages');
        if (!messagesContainer) return;

        const messages = this.chatMode === 'private' && this.privateRecipientId
            ? this.dataService.getChatMessages(this.privateRecipientId)
            : this.dataService.getChatMessages();

        messagesContainer.innerHTML = messages.map(msg => this.renderMessage(msg)).join('');

        if (this.scrolledToBottom) {
            this.scrollToBottom();
        }
    }

    renderMessage(message) {
        const isOwn = message.userId === this.currentUser.id;
        const isPrivate = message.recipientId !== null;
        const time = new Date(message.timestamp);
        const timeStr = time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });

        let attachmentsHtml = '';
        if (message.attachments && message.attachments.length > 0) {
            attachmentsHtml = message.attachments.map(att => {
                if (att.type.startsWith('image/')) {
                    return `<img src="${att.dataUrl}" alt="${att.name}" class="chat-attachment-image" onclick="window.open('${att.dataUrl}', '_blank')">`;
                } else {
                    return `<div class="chat-attachment-file">
                        <i class="fas fa-file"></i>
                        <a href="${att.dataUrl}" download="${att.name}">${att.name}</a>
                    </div>`;
                }
            }).join('');
        }

        return `
            <div class="chat-message-item ${isOwn ? 'own-message' : ''} ${isPrivate ? 'private-message' : ''}">
                <div class="chat-message-header">
                    <span class="chat-message-author">${this.sanitize(message.username)}</span>
                    <span class="chat-message-time">${timeStr}</span>
                </div>
                <div class="chat-message-content">${this.sanitize(message.message)}</div>
                ${attachmentsHtml}
            </div>
        `;
    }

    handleKeyDown(event) {
        if (event.key === 'Enter' && !event.shiftKey) {
            event.preventDefault();
            this.sendMessage();
        }
    }

    handleInput(event) {
        // Simulate typing indicator
        if (!this.isTyping) {
            this.isTyping = true;
            // TODO: Send typing indicator via WebSocket when backend is integrated
        }

        clearTimeout(this.typingTimeout);
        this.typingTimeout = setTimeout(() => {
            this.isTyping = false;
            // TODO: Send stop typing via WebSocket when backend is integrated
        }, 1000);
    }

    sendMessage() {
        const input = document.getElementById('chatInput');
        if (!input) return;

        const text = input.value.trim();
        if (!text && this.pendingFiles.length === 0) return;

        const message = {
            userId: this.currentUser.id,
            username: this.currentUser.name,
            message: text,
            recipientId: this.chatMode === 'private' ? this.privateRecipientId : null,
            attachments: this.pendingFiles || []
        };

        // TODO: Replace with WebSocket.send when backend is integrated
        this.dataService.sendMessage(message);

        input.value = '';
        input.style.height = 'auto';
        this.pendingFiles = [];

        this.loadMessages();
        toastNotifications.success('Message sent');
    }

    handleFileUpload(event) {
        const files = Array.from(event.target.files);
        this.pendingFiles = this.pendingFiles || [];

        files.forEach(file => {
            if (file.size > 5 * 1024 * 1024) { // 5MB limit
                toastNotifications.error('File size must be less than 5MB');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                this.pendingFiles.push({
                    name: file.name,
                    type: file.type,
                    size: file.size,
                    dataUrl: e.target.result
                });
                toastNotifications.success(`Added ${file.name}`);
            };
            reader.readAsDataURL(file);
        });

        event.target.value = '';
    }

    toggleEmojiPicker() {
        const picker = document.getElementById('emojiPicker');
        if (picker) {
            picker.classList.toggle('hidden');
        }
    }

    insertEmoji(emoji) {
        const input = document.getElementById('chatInput');
        if (input) {
            input.value += emoji;
            input.focus();
        }
        this.toggleEmojiPicker();
    }

    handleScroll() {
        const container = document.getElementById('chatMessagesContainer');
        if (!container) return;

        const isAtBottom = container.scrollHeight - container.scrollTop <= container.clientHeight + 50;
        this.scrolledToBottom = isAtBottom;

        if (!isAtBottom && this.newMessagesCount === 0) {
            this.newMessagesCount = 1;
            const badge = document.getElementById('newMessagesBadge');
            if (badge) {
                badge.classList.remove('hidden');
            }
        } else if (isAtBottom) {
            this.newMessagesCount = 0;
            const badge = document.getElementById('newMessagesBadge');
            if (badge) {
                badge.classList.add('hidden');
            }
        }
    }

    scrollToBottom() {
        const container = document.getElementById('chatMessagesContainer');
        if (container) {
            container.scrollTop = container.scrollHeight;
            this.scrolledToBottom = true;
            this.newMessagesCount = 0;
            const badge = document.getElementById('newMessagesBadge');
            if (badge) {
                badge.classList.add('hidden');
            }
        }
    }

    startAutoScroll() {
        // Auto-scroll to bottom on new messages
        const observer = new MutationObserver(() => {
            if (this.scrolledToBottom) {
                this.scrollToBottom();
            }
        });

        const messagesContainer = document.getElementById('chatMessages');
        if (messagesContainer) {
            observer.observe(messagesContainer, { childList: true });
        }
    }

    sanitize(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
}

// Global instance (will be initialized after DOM is ready)
let chatPanel = null;

